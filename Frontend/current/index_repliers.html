<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summitly AI - Real Estate AI with Repliers</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 50%, #e74c3c 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .features-badge {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
        }

        .badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
        }

        .chat-area {
            height: 500px;
            overflow-y: auto;
            padding: 25px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            display: flex;
            justify-content: flex-end;
        }

        .message.agent {
            display: flex;
            justify-content: flex-start;
            flex-direction: column;
        }

        .message-text {
            max-width: 75%;
            padding: 15px 18px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .user .message-text {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .agent .message-text {
            background: white;
            color: #2c3e50;
            max-width: 100%;
        }

        .agent .message-text strong {
            color: #2c3e50;
        }

        /* Property Cards */
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .property-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .property-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%);
        }

        .property-details {
            padding: 15px;
        }

        .property-price {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .property-address {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .property-specs {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .property-spec {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .property-description {
            font-size: 13px;
            color: #95a5a6;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .property-link {
            display: inline-block;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .property-link:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .control-area {
            padding: 25px;
            background: white;
            border-top: 1px solid #ecf0f1;
        }

        .quick-filters {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .filter-section {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
            min-width: 85px;
        }

        .filter-chip {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #3498db;
            border-radius: 20px;
            padding: 8px 14px;
            font-size: 13px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filter-chip:hover {
            background: #3498db;
            color: white;
            border-color: #3498db;
            transform: translateY(-1px);
        }

        .filter-chip:active {
            transform: translateY(0);
        }

        /* AI Features Header Styles */
        .ai-features-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            color: white;
            text-align: center;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-title {
            margin-bottom: 20px;
        }

        .ai-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            letter-spacing: 1px;
            display: inline-block;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .ai-title h2 {
            margin: 10px 0 5px 0;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .ai-title p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .ai-capabilities {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .capability-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }

        .capability-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .capability-text {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

        @media (max-width: 768px) {
            .ai-capabilities {
                gap: 20px;
            }
            .capability-item {
                min-width: 100px;
            }
            .ai-title h2 {
                font-size: 24px;
            }
        }

        /* AI Feature Cards Styles */
        .ai-feature-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .feature-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .feature-card:hover:before {
            opacity: 0.05;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .feature-card * {
            position: relative;
            z-index: 2;
        }

        .feature-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: #2c3e50;
            margin: 0 0 10px 0;
            font-size: 20px;
            font-weight: 600;
        }

        .feature-card p {
            color: #7f8c8d;
            margin: 0 0 15px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        .try-example {
            background: #e3f2fd;
            color: #1976d2;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
            border: 1px solid #bbdefb;
        }

        @media (max-width: 768px) {
            .ai-feature-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .feature-card {
                padding: 20px;
            }
        }

        /* AI Message Indicators */
        .ai-badge-message {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
            display: inline-block;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .thinking-dots {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 15px;
        }

        .thinking-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: thinking 1.4s infinite ease-in-out;
        }

        .thinking-dots span:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dots span:nth-child(2) { animation-delay: -0.16s; }
        .thinking-dots span:nth-child(3) { animation-delay: 0s; }

        @keyframes thinking {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Enhanced Loading States for Production */
        .ai-processing {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            background-size: 200% 100%;
            animation: gradient-loading 2s infinite;
            color: white;
            padding: 12px 18px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        @keyframes gradient-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .status-indicator {
            padding: 8px 16px;
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator.processing {
            background: #fff8e1;
            border-left-color: #ffc107;
        }

        .status-indicator.success {
            background: #e8f5e8;
            border-left-color: #28a745;
        }

        .status-indicator.error {
            background: #ffeaea;
            border-left-color: #dc3545;
        }

        .message.thinking {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }

        /* Smart Suggestions Panel */
        .smart-suggestions-panel {
            position: fixed;
            right: -350px;
            top: 50%;
            transform: translateY(-50%);
            width: 320px;
            max-height: 70vh;
            background: white;
            border-radius: 15px 0 0 15px;
            box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .smart-suggestions-panel.active {
            right: 0;
        }

        .suggestions-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestions-title {
            font-weight: 600;
            font-size: 16px;
        }

        .close-suggestions {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .suggestions-content {
            padding: 20px;
            max-height: calc(70vh - 60px);
            overflow-y: auto;
        }

        .suggestion-category {
            margin-bottom: 25px;
        }

        .suggestion-category h4 {
            color: #2c3e50;
            margin: 0 0 12px 0;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 8px;
        }

        .suggestion-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 13px;
            color: #495057;
            transition: all 0.2s ease;
        }

        .suggestion-item:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateX(3px);
        }

        .suggestions-toggle {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px 20px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            box-shadow: -3px 0 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 999;
            transform-origin: center;
        }

        .suggestions-toggle:hover {
            transform: translateY(-50%) rotate(-90deg) translateY(-3px);
        }

        .suggestions-toggle.active {
            right: 340px;
        }

        @media (max-width: 768px) {
            .smart-suggestions-panel {
                width: 100%;
                right: -100%;
                top: 0;
                transform: none;
                max-height: 100vh;
                border-radius: 0;
            }
            
            .suggestions-toggle {
                right: 10px;
                top: auto;
                bottom: 100px;
                transform: none;
                border-radius: 20px;
            }
            
            .suggestions-toggle.active {
                right: 10px;
            }
        }

        /* Multimodal Panel Styles */
        .multimodal-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #667eea;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .close-panel {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-panel:hover {
            background: rgba(255,255,255,0.2);
        }

        .panel-content {
            padding: 20px;
        }

        .media-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .media-option {
            text-align: center;
        }

        .upload-btn, .record-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            margin-bottom: 10px;
        }

        .upload-btn:hover, .record-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .image-upload-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .video-upload-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .preview {
            min-height: 60px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
            margin-top: 10px;
            position: relative;
        }

        .preview img, .preview video {
            max-width: 100%;
            max-height: 100px;
            border-radius: 8px;
        }

        .preview audio {
            width: 100%;
        }

        .audio-controls {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stop-record-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            margin-left: 10px;
        }

        .multimodal-input-group {
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .multimodal-input-group input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
            transition: border-color 0.3s;
        }

        .multimodal-input-group input[type="text"]:focus {
            border-color: #667eea;
        }

        .voice-options {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .voice-options select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .voice-options label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .send-multimodal-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
        }

        .send-multimodal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .send-multimodal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .media-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        @media (max-width: 768px) {
            .media-options {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .voice-options {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .input-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .text-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ecf0f1;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .text-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .mic-btn, .insights-btn, .reset-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .mic-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .mic-btn.recording {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(243, 156, 18, 0); }
            100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0); }
        }

        .insights-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }

        .insights-btn:hover {
            background: linear-gradient(135deg, #8e44ad 0%, #732d91 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .reset-btn {
            background: #95a5a6;
            color: white;
        }

        .status {
            text-align: center;
            font-size: 13px;
            color: #7f8c8d;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
            font-size: 13px;
            color: #1565c0;
        }

        /* Location Insights Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #f39c12;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
            max-height: calc(80vh - 100px);
        }

        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #9b59b6;
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #8e44ad;
        }

        .location-input-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .location-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .location-input:focus {
            border-color: #9b59b6;
        }

        .get-insights-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .get-insights-btn:hover {
            background: linear-gradient(135deg, #8e44ad 0%, #732d91 100%);
            transform: translateY(-2px);
        }

        .insights-results {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 1px solid #e0e0e0;
        }

        .insights-results::-webkit-scrollbar {
            width: 8px;
        }

        .insights-results::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .insights-results::-webkit-scrollbar-thumb {
            background: #9b59b6;
            border-radius: 10px;
        }

        .insights-results::-webkit-scrollbar-thumb:hover {
            background: #8e44ad;
        }

        .insights-content {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #9b59b6;
        }

        .insights-content h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .insights-text {
            line-height: 1.6;
            color: #34495e;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .insights-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .search-properties-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-properties-btn:hover {
            background: linear-gradient(135deg, #229954 0%, #27ae60 100%);
            transform: translateY(-2px);
        }

        .close-insights-btn {
            padding: 12px 24px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .close-insights-btn:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
        }

        /* Property Analysis Styles */
        .property-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .analyze-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            background: linear-gradient(135deg, #8e44ad 0%, #732d91 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.3);
        }

        .property-analysis {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            border-left: 5px solid #9b59b6;
        }

        .analysis-header h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 22px;
        }

        .analysis-opening {
            font-size: 16px;
            color: #2c3e50;
            font-weight: 600;
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .insight-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .insight-card:hover {
            transform: translateY(-2px);
        }

        .insight-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .insight-icon {
            font-size: 24px;
        }

        .insight-title {
            font-weight: 600;
            color: #2c3e50;
            flex-grow: 1;
            margin-left: 10px;
        }

        .insight-score {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .insight-text {
            color: #34495e;
            line-height: 1.6;
            font-size: 14px;
        }

        .value-prediction {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .prediction-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .prediction-icon {
            font-size: 24px;
        }

        .prediction-title {
            font-weight: 600;
            font-size: 18px;
            flex-grow: 1;
            margin-left: 10px;
        }

        .investment-grade {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .prediction-text {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .prediction-timeline {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        .prediction-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 10px;
            flex: 1;
        }

        .timeline-year {
            display: block;
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .timeline-value {
            display: block;
            font-size: 18px;
            font-weight: 600;
        }

        .lifestyle-summary {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .lifestyle-summary h4 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .lifestyle-summary p {
            color: #34495e;
            line-height: 1.6;
            font-size: 14px;
        }

        .attractions {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 20px;
        }

        .attractions h4 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .attractions ul {
            list-style: none;
            padding: 0;
        }

        .attractions li {
            color: #34495e;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }

        .attractions li:last-child {
            border-bottom: none;
        }

        .analysis-message {
            max-width: 90%;
        }

        @media (max-width: 768px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .prediction-timeline {
                flex-direction: column;
            }
            
            .prediction-item {
                margin-bottom: 10px;
            }
        }

        @media (max-width: 768px) {
            .properties-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Summitly AI</h1>
            <p>AI Real Estate Assistant with Repliers Integration</p>
            <div class="features-badge">
                <span class="badge">üí¨ Text + Voice</span>
                <span class="badge">üì∏ Property Images</span>
                <span class="badge">üîó Direct Links</span>
                <span class="badge">ü§ñ AI Powered</span>
            </div>
        </div>

        <!-- AI Features Showcase Header -->
        <div class="ai-features-header">
            <div class="ai-title">
                <span class="ai-badge">ü§ñ AI-POWERED</span>
                <h2>Smart Real Estate Assistant</h2>
                <p>Advanced AI technology for intelligent property search and market analysis</p>
            </div>
            <div class="ai-capabilities">
                <div class="capability-item">
                    <span class="capability-icon">üè†</span>
                    <span class="capability-text">Smart Property Search</span>
                </div>
                <div class="capability-item">
                    <span class="capability-icon">üìä</span>
                    <span class="capability-text">Market Analysis</span>
                </div>
                <div class="capability-item">
                    <span class="capability-icon">üí°</span>
                    <span class="capability-text">Investment Insights</span>
                </div>
                <div class="capability-item">
                    <span class="capability-icon">üó∫Ô∏è</span>
                    <span class="capability-text">Location Intelligence</span>
                </div>
            </div>
        </div>

        <!-- Interactive AI Feature Cards -->
        <div class="ai-feature-cards">
            <div class="feature-card" onclick="applyFilter('analyze market trends in Toronto')">
                <div class="feature-icon">üìà</div>
                <h3>Market Analysis</h3>
                <p>Get AI-powered insights on property trends, price predictions, and market dynamics</p>
                <span class="try-example">Try: "Analyze market trends in Toronto"</span>
            </div>
            <div class="feature-card" onclick="applyFilter('find investment properties under 600k')">
                <div class="feature-icon">üí∞</div>
                <h3>Investment Scanner</h3>
                <p>Discover high-potential investment properties with ROI analysis and growth projections</p>
                <span class="try-example">Try: "Find investment properties under 600k"</span>
            </div>
            <div class="feature-card" onclick="applyFilter('compare neighborhoods in Vancouver')">
                <div class="feature-icon">üèòÔ∏è</div>
                <h3>Area Comparison</h3>
                <p>Compare different neighborhoods with lifestyle, amenities, and price analysis</p>
                <span class="try-example">Try: "Compare neighborhoods in Vancouver"</span>
            </div>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="info">
                üöÄ <strong>Welcome!</strong><br>
                Search properties with natural language and get real images and links from Repliers!<br>
                Try: "Show me 2-bedroom condos in Toronto under $500k"
            </div>
        </div>

        <div class="control-area">
            <!-- Quick Filters -->
            <div class="quick-filters" id="quickFilters">
                <div class="filter-section">
                    <span class="filter-label">Quick Search:</span>
                    <button class="filter-chip" onclick="applyFilter('show me properties')">üè† View Properties</button>
                    <button class="filter-chip" onclick="applyFilter('condos under 800k')">üí∞ Under $800K</button>
                    <button class="filter-chip" onclick="applyFilter('downtown condos')">üèôÔ∏è Downtown</button>
                    <button class="filter-chip" onclick="applyFilter('investment properties')">üìà Investment</button>
                </div>
                <div class="filter-section">
                    <span class="filter-label">Location:</span>
                    <button class="filter-chip" onclick="applyFilter('North York condos')">North York</button>
                    <button class="filter-chip" onclick="applyFilter('Scarborough properties')">Scarborough</button>
                    <button class="filter-chip" onclick="applyFilter('Etobicoke condos')">Etobicoke</button>
                    <button class="filter-chip" onclick="applyFilter('waterfront properties')">Waterfront</button>
                </div>
            </div>
            
            <div class="input-container">
                <input 
                    type="text" 
                    class="text-input" 
                    id="textInput" 
                    placeholder="Type your property search... (e.g., '3 bed house in Brooklyn with parking')"
                >
                <button class="send-btn" id="sendBtn">‚û§</button>
            </div>

            <div class="button-group">
                <button class="mic-btn" id="micBtn">üé§ Voice</button>
                <button class="media-btn" id="mediaBtn">üì∑ Media</button>
                <button class="insights-btn" id="insightsBtn">üèôÔ∏è AI Location Insights</button>
                <button class="reset-btn" id="resetBtn">Reset Chat</button>
            </div>

            <!-- Multimodal Input Panel -->
            <div class="multimodal-panel" id="multimodalPanel" style="display: none;">
                <div class="panel-header">
                    <h3>ü§ñ Qwen2.5-Omni Multimodal Chat</h3>
                    <button class="close-panel" onclick="closeMultimodalPanel()">√ó</button>
                </div>
                <div class="panel-content">
                    <div class="media-options">
                        <div class="media-option">
                            <label for="imageUpload" class="upload-btn image-upload-btn">
                                üì∑ Upload Image
                            </label>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                            <div class="preview" id="imagePreview"></div>
                        </div>
                        <div class="media-option">
                            <label for="videoUpload" class="upload-btn video-upload-btn">
                                üé• Upload Video
                            </label>
                            <input type="file" id="videoUpload" accept="video/*" style="display: none;">
                            <div class="preview" id="videoPreview"></div>
                        </div>
                        <div class="media-option">
                            <button class="record-btn" id="recordAudioBtn">üé§ Record Audio</button>
                            <div class="audio-controls" id="audioControls" style="display: none;">
                                <span id="recordingStatus">Recording...</span>
                                <button class="stop-record-btn" id="stopRecordBtn">‚èπÔ∏è Stop</button>
                            </div>
                            <div class="preview" id="audioPreview"></div>
                        </div>
                    </div>
                    <div class="multimodal-input-group">
                        <input type="text" id="multimodalTextInput" placeholder="Type your message... (optional with media)">
                        <div class="voice-options">
                            <label>Voice:</label>
                            <select id="voiceSelect">
                                <option value="Chelsie">Chelsie (Female)</option>
                                <option value="Ethan">Ethan (Male)</option>
                            </select>
                            <label>
                                <input type="checkbox" id="returnAudio" checked> Include Audio Response
                            </label>
                        </div>
                        <button class="send-multimodal-btn" id="sendMultimodalBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Smart Suggestions Panel -->
        <div class="smart-suggestions-panel" id="smartSuggestions">
            <div class="suggestions-header">
                <span class="suggestions-title">üí° Smart Suggestions</span>
                <button class="close-suggestions" onclick="toggleSuggestions()">√ó</button>
            </div>
            <div class="suggestions-content">
                <div class="suggestion-category">
                    <h4>üè† Property Search</h4>
                    <div class="suggestion-item" onclick="applyFilter('modern condos with parking')">Modern condos with parking</div>
                    <div class="suggestion-item" onclick="applyFilter('family homes near schools')">Family homes near schools</div>
                    <div class="suggestion-item" onclick="applyFilter('luxury penthouses downtown')">Luxury penthouses downtown</div>
                </div>
                <div class="suggestion-category">
                    <h4>üìä Market Analysis</h4>
                    <div class="suggestion-item" onclick="applyFilter('price trends last 6 months')">Price trends last 6 months</div>
                    <div class="suggestion-item" onclick="applyFilter('best areas for investment')">Best areas for investment</div>
                    <div class="suggestion-item" onclick="applyFilter('compare Toronto vs Vancouver')">Compare Toronto vs Vancouver</div>
                </div>
                <div class="suggestion-category">
                    <h4>üó∫Ô∏è Location Intelligence</h4>
                    <div class="suggestion-item" onclick="applyFilter('walkable neighborhoods')">Walkable neighborhoods</div>
                    <div class="suggestion-item" onclick="applyFilter('transit-friendly areas')">Transit-friendly areas</div>
                    <div class="suggestion-item" onclick="applyFilter('upcoming development zones')">Upcoming development zones</div>
                </div>
            </div>
        </div>

        <!-- Suggestions Toggle Button -->
        <button class="suggestions-toggle" id="suggestionsToggle" onclick="toggleSuggestions()">
            üí° Smart Suggestions
        </button>
    </div>

    <script>
        const SERVER_URL = `http://${window.location.hostname}:5050`;
        
        let sessionId = null;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let stream = null;
        
        const chatArea = document.getElementById('chatArea');
        const textInput = document.getElementById('textInput');
        const sendBtn = document.getElementById('sendBtn');
        const micBtn = document.getElementById('micBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        function scrollToBottom() {
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function analyzeProperty(propertyId, propertyLocation, event) {
            try {
                console.log('ü§ñ Starting property analysis...', propertyId, propertyLocation);
                
                // Get full property data from the button's data attribute
                let property = null;
                if (event && event.target) {
                    const propertyData = event.target.getAttribute('data-property');
                    if (propertyData) {
                        property = JSON.parse(propertyData.replace(/&#39;/g, "'"));
                    }
                }
                
                // Fallback: create basic property object
                if (!property) {
                    property = {
                        id: propertyId,
                        location: propertyLocation,
                        title: `Property in ${propertyLocation}`
                    };
                }
                
                console.log('ü§ñ Property data:', property);
                
                // Show enhanced analysis loading message
                addMessage('Great choice! Let me analyze this property for you... üè†‚ú®', 'agent');
                showStatus('Running comprehensive property analysis with AI...', 'thinking');
                
                const response = await fetch('/api/property-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ property: property })
                });

                const result = await response.json();
                console.log('ü§ñ Analysis result:', result);
                
                // Remove loading status
                chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
                
                if (result.success) {
                    showSuccessStatus('Analysis complete! üéâ');
                    displayPropertyAnalysis(result.analysis, property);
                    // Start conversation mode
                    startPropertyConversation(result.property_id, result.analysis);
                } else {
                    showErrorStatus('Analysis failed. Trying alternative approach...');
                    addMessage('Sorry, I had trouble analyzing this property. Let me try a different approach!', 'agent');
                }
            } catch (error) {
                console.error('Property analysis error:', error);
                chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
                showErrorStatus('Property analysis temporarily unavailable.');
                addMessage('Oops! There was an issue getting the analysis. Please try clicking the button again!', 'agent');
            }
        }

        function displayPropertyAnalysis(analysis, property) {
            const analysisContainer = document.createElement('div');
            analysisContainer.className = 'property-analysis';
            
            analysisContainer.innerHTML = `
                <div class="analysis-header">
                    <h3>üè† Property Analysis</h3>
                </div>
                
                <div class="analysis-content">
                    <div class="opening-message">
                        <p class="analysis-opening">${analysis.opening_line}</p>
                    </div>
                    
                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-header">
                                <span class="insight-icon">üèòÔ∏è</span>
                                <span class="insight-title">Neighborhood</span>
                                <span class="insight-score">${analysis.scores?.neighborhood || 'N/A'}/100</span>
                            </div>
                            <p class="insight-text">${analysis.neighborhood_insight}</p>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-header">
                                <span class="insight-icon">üöä</span>
                                <span class="insight-title">Connectivity</span>
                                <span class="insight-score">${analysis.scores?.connectivity || 'N/A'}/100</span>
                            </div>
                            <p class="insight-text">${analysis.connectivity_insight}</p>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-header">
                                <span class="insight-icon">üõ°Ô∏è</span>
                                <span class="insight-title">Safety</span>
                                <span class="insight-score">${analysis.scores?.safety || 'N/A'}/100</span>
                            </div>
                            <p class="insight-text">${analysis.safety_insight}</p>
                        </div>
                        
                        <div class="insight-card">
                            <div class="insight-header">
                                <span class="insight-icon">üìà</span>
                                <span class="insight-title">Growth Potential</span>
                                <span class="insight-score">${analysis.scores?.growth_potential || 'N/A'}/100</span>
                            </div>
                            <p class="insight-text">${analysis.growth_insight}</p>
                        </div>
                    </div>
                    
                    ${analysis.value_prediction ? `
                    <div class="value-prediction">
                        <div class="prediction-header">
                            <span class="prediction-icon">üîÆ</span>
                            <span class="prediction-title">AI Value Prediction</span>
                            <span class="investment-grade">${analysis.value_prediction.investment_grade}</span>
                        </div>
                        <p class="prediction-text">${analysis.value_prediction.prediction_text}</p>
                        ${analysis.value_prediction.predictions ? `
                        <div class="prediction-timeline">
                            <div class="prediction-item">
                                <span class="timeline-year">1 Year</span>
                                <span class="timeline-value">+${analysis.value_prediction.predictions['1_year']?.percentage_increase}%</span>
                            </div>
                            <div class="prediction-item">
                                <span class="timeline-year">3 Years</span>
                                <span class="timeline-value">+${analysis.value_prediction.predictions['3_year']?.percentage_increase}%</span>
                            </div>
                            <div class="prediction-item">
                                <span class="timeline-year">5 Years</span>
                                <span class="timeline-value">+${analysis.value_prediction.predictions['5_year']?.percentage_increase}%</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    <div class="lifestyle-summary">
                        <h4>üåü Lifestyle Overview</h4>
                        <p>${analysis.lifestyle_summary}</p>
                    </div>
                    
                    ${analysis.attractions && analysis.attractions.length > 0 ? `
                    <div class="attractions">
                        <h4>üìç Nearby Attractions</h4>
                        <ul>
                            ${analysis.attractions.map(attraction => `<li>${attraction}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
            `;
            
            const messageEl = document.createElement('div');
            messageEl.className = 'message agent analysis-message';
            messageEl.appendChild(analysisContainer);
            chatArea.appendChild(messageEl);
            scrollToBottom();
        }

        function startPropertyConversation(propertyId, analysis) {
            // Add conversation starter
            setTimeout(() => {
                const starters = analysis.conversation_starters || ["What would you like to know more about?"];
                const randomStarter = starters[Math.floor(Math.random() * starters.length)];
                addMessage(randomStarter, 'agent');
                
                // Enable conversation mode
                window.currentPropertyId = propertyId;
                window.propertyConversationMode = true;
            }, 1500);
        }
        
        function addMessage(text, sender, messageType = 'text') {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            
            // Add AI badge for assistant messages
            if (sender === 'assistant') {
                const aiBadge = document.createElement('div');
                aiBadge.className = 'ai-badge-message';
                
                let badgeText = 'ü§ñ AI Assistant';
                let badgeColor = '#667eea';
                
                if (messageType === 'property_search') {
                    badgeText = 'üè† Smart Search';
                    badgeColor = '#27ae60';
                } else if (messageType === 'market_analysis') {
                    badgeText = 'üìä Market AI';
                    badgeColor = '#e74c3c';
                } else if (messageType === 'location_insights') {
                    badgeText = 'üó∫Ô∏è Location AI';
                    badgeColor = '#f39c12';
                }
                
                aiBadge.innerHTML = badgeText;
                aiBadge.style.backgroundColor = badgeColor;
                messageEl.appendChild(aiBadge);
            }
            
            const textEl = document.createElement('div');
            textEl.className = 'message-text';
            
            // Format markdown-style text
            const formatted = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
            
            textEl.innerHTML = formatted;
            messageEl.appendChild(textEl);
            chatArea.appendChild(messageEl);
            scrollToBottom();
        }

        function addThinkingIndicator() {
            const thinkingEl = document.createElement('div');
            thinkingEl.className = 'message assistant thinking';
            thinkingEl.id = 'thinking-indicator';
            
            const badge = document.createElement('div');
            badge.className = 'ai-badge-message';
            badge.innerHTML = 'ü§ñ AI Processing';
            badge.style.backgroundColor = '#667eea';
            
            const dotsEl = document.createElement('div');
            dotsEl.className = 'thinking-dots';
            dotsEl.innerHTML = '<span></span><span></span><span></span>';
            
            thinkingEl.appendChild(badge);
            thinkingEl.appendChild(dotsEl);
            chatArea.appendChild(thinkingEl);
            scrollToBottom();
            
            return thinkingEl;
        }

        function removeThinkingIndicator() {
            const thinking = document.getElementById('thinking-indicator');
            if (thinking) {
                thinking.remove();
            }
        }
        
        function addPropertyCards(properties) {
            if (!properties || properties.length === 0) return;
            
            const gridContainer = document.createElement('div');
            gridContainer.className = 'properties-grid';
            
            properties.forEach(prop => {
                const card = document.createElement('div');
                card.className = 'property-card';
                card.style.cursor = 'pointer';
                card.onclick = () => analyzeProperty(prop);
                
                const img = document.createElement('img');
                img.className = 'property-image';
                
                // Show loading placeholder initially
                const loadingPlaceholder = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200"><rect fill="%23f0f0f0" width="400" height="200"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23999" font-family="Arial" font-size="14">Loading Image...</text></svg>';
                const errorPlaceholder = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200"><rect fill="%23e0e0e0" width="400" height="200"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="%23666" font-family="Arial" font-size="14">Property Image</text></svg>';
                
                img.src = loadingPlaceholder;
                img.alt = prop.location || prop.address || 'Property';
                
                // Handle image loading
                img.onload = function() {
                    console.log('‚úÖ Image loaded:', prop.image_url || prop.image);
                };
                
                img.onerror = function() {
                    console.log('‚ùå Image failed to load:', prop.image_url || prop.image);
                    this.src = errorPlaceholder;
                };
                
                // Set the actual image URL
                const imageUrl = prop.image_url || prop.image;
                if (imageUrl) {
                    img.src = imageUrl;
                } else {
                    img.src = errorPlaceholder;
                }
                
                const details = document.createElement('div');
                details.className = 'property-details';
                
                details.innerHTML = `
                    <div class="property-price">${prop.price || 'Price on Request'}</div>
                    <div class="property-address">${prop.location || prop.address || 'Property Address'}</div>
                    <div class="property-specs">
                        <div class="property-spec">üõèÔ∏è ${prop.bedrooms || 0} bed</div>
                        <div class="property-spec">üõÅ ${prop.bathrooms || 0} bath</div>
                        ${prop.sqft && prop.sqft !== 'N/A' ? `<div class="property-spec">üìè ${prop.sqft} sqft</div>` : ''}
                    </div>
                    <div class="property-description">${prop.description || ''}</div>
                    <div class="property-actions">
                        <button class="analyze-btn" onclick="event.stopPropagation(); analyzeProperty('${prop.id || prop.title || ''}', '${(prop.location || '').replace(/'/g, '\\\'').replace(/"/g, '&quot;')}', event)" data-property='${JSON.stringify(prop).replace(/'/g, '&#39;').replace(/"/g, '&quot;')}'>ü§ñ AI Analysis</button>
                        ${prop.listing_url ? `<a href="${prop.listing_url}" target="_blank" class="property-link" onclick="event.stopPropagation()">View Details ‚Üí</a>` : ''}
                    </div>
                `;
                
                card.appendChild(img);
                card.appendChild(details);
                gridContainer.appendChild(card);
            });
            
            const messageEl = document.createElement('div');
            messageEl.className = 'message agent';
            messageEl.appendChild(gridContainer);
            chatArea.appendChild(messageEl);
            scrollToBottom();
        }
        
        function showStatus(status, type = 'processing') {
            // Remove any existing status indicators
            chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
            
            const statusEl = document.createElement('div');
            statusEl.className = `status-indicator ${type}`;
            statusEl.innerHTML = `<span class="status-icon">${getStatusIcon(type)}</span>${status}`;
            chatArea.appendChild(statusEl);
            scrollToBottom();
        }
        
        function getStatusIcon(type) {
            switch(type) {
                case 'processing': return '‚è≥';
                case 'success': return '‚úÖ';
                case 'error': return '‚ùå';
                case 'thinking': return 'ü§ñ';
                default: return 'üìã';
            }
        }
        
        function showSuccessStatus(message) {
            showStatus(message, 'success');
            setTimeout(() => {
                chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
            }, 3000);
        }
        
        function showErrorStatus(message) {
            showStatus(message, 'error');
            setTimeout(() => {
                chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
            }, 5000);
        }
        
        function playAudio(base64Audio) {
            if (!base64Audio) return;
            try {
                const audioData = atob(base64Audio);
                const arrayBuffer = new ArrayBuffer(audioData.length);
                const view = new Uint8Array(arrayBuffer);
                for (let i = 0; i < audioData.length; i++) {
                    view[i] = audioData.charCodeAt(i);
                }
                const blob = new Blob([arrayBuffer], { type: 'audio/wav' });
                const audio = new Audio(URL.createObjectURL(blob));
                audio.play();
            } catch (e) {
                console.error('Audio error:', e);
            }
        }
        
        async function sendTextMessage(message) {
            if (!message.trim() || !sessionId) return;
            
            try {
                addMessage(message, 'user');
                textInput.value = '';
                sendBtn.disabled = true;
                
                // Add thinking indicator
                const thinkingIndicator = addThinkingIndicator();
                
                // Check if we're in property conversation mode
                if (window.propertyConversationMode && window.currentPropertyId) {
                    showStatus('ü§ñ Thinking about your question...');
                    
                    const response = await fetch(`${SERVER_URL}/api/property-conversation`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            property_id: window.currentPropertyId,
                            message: message,
                            history: window.conversationHistory || []
                        })
                    });
                    
                    const data = await response.json();
                    
                    removeThinkingIndicator();
                    
                    if (data.success) {
                        addMessage(data.response, 'assistant', 'property_conversation');
                        // Add to conversation history
                        if (!window.conversationHistory) window.conversationHistory = [];
                        window.conversationHistory.push({user: message, agent: data.response});
                    } else {
                        addMessage('Let me think about that... What else would you like to know about this property?', 'assistant');
                    }
                } else {
                    // Regular property search
                    showStatus('Searching properties with AI analysis...', 'thinking');
                    
                    const response = await fetch(`${SERVER_URL}/api/text-chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: message,
                            session_id: sessionId
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                
                    // Remove status and thinking indicator
                    chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
                    removeThinkingIndicator();
                    
                    if (data.success) {
                        let messageType = 'text';
                        if (data.properties && data.properties.length > 0) {
                            messageType = 'property_search';
                        }
                        
                        if (data.agent_response) {
                            addMessage(data.agent_response, 'assistant', messageType);
                        }
                        if (data.properties && data.properties.length > 0) {
                            addPropertyCards(data.properties);
                        }
                    }
                }
                
            } catch (error) {
                console.error('Error:', error);
                chatArea.querySelectorAll('.status-indicator').forEach(el => el.remove());
                removeThinkingIndicator();
                
                // Show user-friendly error message
                if (error.message.includes('500')) {
                    showErrorStatus('Server is experiencing issues. Please try again in a moment.');
                } else if (error.message.includes('network')) {
                    showErrorStatus('Network connection issue. Please check your connection.');
                } else {
                    showErrorStatus('Something went wrong. Please try your request again.');
                }
            } finally {
                sendBtn.disabled = false;
                textInput.focus();
            }
        }
        
        async function startRecording() {
            if (!stream) {
                stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            }
            
            audioChunks = [];
            mediaRecorder = new MediaRecorder(stream);
            
            mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
            mediaRecorder.onstop = async () => {
                const blob = new Blob(audioChunks, { type: 'audio/webm' });
                await sendVoiceMessage(blob);
            };
            
            mediaRecorder.start();
            isRecording = true;
            micBtn.classList.add('recording');
            micBtn.textContent = '‚èπÔ∏è Stop';
            showStatus('üé§ Recording...');
        }
        
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                micBtn.classList.remove('recording');
                micBtn.textContent = 'üé§ Voice';
                micBtn.disabled = true;
            }
        }
        
        async function sendVoiceMessage(audioBlob) {
            try {
                const formData = new FormData();
                formData.append('audio', audioBlob);
                formData.append('session_id', sessionId);
                
                showStatus('‚è≥ Processing voice...');
                
                const response = await fetch(`${SERVER_URL}/api/voice-chat`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                chatArea.querySelectorAll('.status').forEach(el => el.remove());
                
                if (data.success) {
                    if (data.user_text) {
                        addMessage(`üé§ ${data.user_text}`, 'user');
                    }
                    if (data.agent_response) {
                        addMessage(data.agent_response, 'agent');
                    }
                    if (data.properties && data.properties.length > 0) {
                        addPropertyCards(data.properties);
                    }
                    if (data.audio_response) {
                        playAudio(data.audio_response);
                    }
                }
            } catch (error) {
                console.error('Voice error:', error);
                chatArea.querySelectorAll('.status').forEach(el => el.remove());
            } finally {
                micBtn.disabled = false;
            }
        }
        
        async function initializeSession() {
            try {
                showStatus('üöÄ Connecting...');
                
                const response = await fetch(`${SERVER_URL}/api/voice-init`);
                const data = await response.json();
                
                chatArea.innerHTML = '';
                
                if (data.success) {
                    sessionId = data.session_id;
                    addMessage(data.agent_response, 'agent');
                    if (data.audio_response) {
                        playAudio(data.audio_response);
                    }
                    textInput.disabled = false;
                    sendBtn.disabled = false;
                    micBtn.disabled = false;
                    textInput.focus();
                }
            } catch (error) {
                console.error('Init error:', error);
            }
        }
        
        async function resetChat() {
            chatArea.innerHTML = '';
            sessionId = null;
            textInput.value = '';
            textInput.disabled = true;
            sendBtn.disabled = true;
            micBtn.disabled = true;
            await initializeSession();
        }
        
        // Event Listeners
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendTextMessage(textInput.value);
            }
        });
        
        sendBtn.addEventListener('click', () => {
            sendTextMessage(textInput.value);
        });
        
        micBtn.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        });
        
        resetBtn.addEventListener('click', resetChat);
        
        // Location Insights functionality
        document.getElementById('insightsBtn').addEventListener('click', () => {
            showLocationInsightsModal();
        });
        
        window.addEventListener('load', () => {
            textInput.disabled = true;
            sendBtn.disabled = true;
            micBtn.disabled = true;
            initializeSession();
        });

        // Location Insights Modal Functions
        function showLocationInsightsModal() {
            document.getElementById('insightsModal').style.display = 'block';
            document.getElementById('locationInput').focus();
        }

        function closeLocationInsightsModal() {
            document.getElementById('insightsModal').style.display = 'none';
            document.getElementById('insightsResults').style.display = 'none';
            document.getElementById('locationInput').value = '';
        }

        async function getLocationInsights(location) {
            try {
                const response = await fetch('/api/location-insights', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ location: location })
                });

                const result = await response.json();
                
                if (result.success) {
                    displayLocationInsights(result);
                } else {
                    document.getElementById('insightsResults').innerHTML = 
                        '<div class="error">Failed to get location insights. Please try again.</div>';
                    document.getElementById('insightsResults').style.display = 'block';
                }
            } catch (error) {
                console.error('Location insights error:', error);
                document.getElementById('insightsResults').innerHTML = 
                    '<div class="error">Error connecting to server. Please try again.</div>';
                document.getElementById('insightsResults').style.display = 'block';
            }
        }

        function displayLocationInsights(result) {
            const resultsDiv = document.getElementById('insightsResults');
            resultsDiv.innerHTML = `
                <div class="insights-content">
                    <h3>üìç ${result.location}</h3>
                    <div class="insights-text">${result.analysis.replace(/\n/g, '<br>')}</div>
                    <div class="insights-actions">
                        <button onclick="searchPropertiesInLocation('${result.location}')" class="search-properties-btn">
                            üè† Search Properties Here
                        </button>
                        <button onclick="closeLocationInsightsModal()" class="close-insights-btn">
                            Close
                        </button>
                    </div>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        function searchPropertiesInLocation(location) {
            closeLocationInsightsModal();
            const searchQuery = `Show me properties in ${location}`;
            textInput.value = searchQuery;
            sendTextMessage(searchQuery);
        }

        // Location input event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const locationInput = document.getElementById('locationInput');
            const getInsightsBtn = document.getElementById('getInsightsBtn');
            
            if (locationInput) {
                locationInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const location = locationInput.value.trim();
                        if (location) {
                            getLocationInsights(location);
                        }
                    }
                });
            }
            
            if (getInsightsBtn) {
                getInsightsBtn.addEventListener('click', () => {
                    const location = locationInput.value.trim();
                    if (location) {
                        getLocationInsights(location);
                    }
                });
            }
        });

        // Apply filter function for quick filter chips
        function applyFilter(filterText) {
            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.value = filterText;
                sendTextMessage(filterText);
                // Close suggestions panel after selection
                const panel = document.getElementById('smartSuggestions');
                const toggle = document.getElementById('suggestionsToggle');
                if (panel && toggle) {
                    panel.classList.remove('active');
                    toggle.classList.remove('active');
                }
            }
        }

        // Toggle smart suggestions panel
        function toggleSuggestions() {
            const panel = document.getElementById('smartSuggestions');
            const toggle = document.getElementById('suggestionsToggle');
            
            if (panel && toggle) {
                panel.classList.toggle('active');
                toggle.classList.toggle('active');
            }
        }



        // Multimodal functionality
        let currentAudioBlob = null;
        let currentImageFile = null;
        let currentVideoFile = null;
        let audioRecorder = null;
        let audioStream = null;

        // Initialize multimodal event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const mediaBtn = document.getElementById('mediaBtn');
            const imageUpload = document.getElementById('imageUpload');
            const videoUpload = document.getElementById('videoUpload');
            const recordAudioBtn = document.getElementById('recordAudioBtn');
            const stopRecordBtn = document.getElementById('stopRecordBtn');
            const sendMultimodalBtn = document.getElementById('sendMultimodalBtn');

            if (mediaBtn) {
                mediaBtn.addEventListener('click', showMultimodalPanel);
            }

            if (imageUpload) {
                imageUpload.addEventListener('change', handleImageUpload);
            }

            if (videoUpload) {
                videoUpload.addEventListener('change', handleVideoUpload);
            }

            if (recordAudioBtn) {
                recordAudioBtn.addEventListener('click', startAudioRecording);
            }

            if (stopRecordBtn) {
                stopRecordBtn.addEventListener('click', stopAudioRecording);
            }

            if (sendMultimodalBtn) {
                sendMultimodalBtn.addEventListener('click', sendMultimodalMessage);
            }
        });

        function showMultimodalPanel() {
            const panel = document.getElementById('multimodalPanel');
            if (panel) {
                panel.style.display = 'block';
                panel.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function closeMultimodalPanel() {
            const panel = document.getElementById('multimodalPanel');
            if (panel) {
                panel.style.display = 'none';
                // Clear all uploads
                clearMultimodalInputs();
            }
        }

        function clearMultimodalInputs() {
            currentAudioBlob = null;
            currentImageFile = null;
            currentVideoFile = null;
            
            document.getElementById('imagePreview').innerHTML = 'No image selected';
            document.getElementById('videoPreview').innerHTML = 'No video selected';
            document.getElementById('audioPreview').innerHTML = 'No audio recorded';
            document.getElementById('multimodalTextInput').value = '';
            document.getElementById('imageUpload').value = '';
            document.getElementById('videoUpload').value = '';
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                currentImageFile = file;
                const preview = document.getElementById('imagePreview');
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.onload = () => URL.revokeObjectURL(img.src);
                preview.innerHTML = '';
                preview.appendChild(img);
            }
        }

        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                currentVideoFile = file;
                const preview = document.getElementById('videoPreview');
                const video = document.createElement('video');
                video.src = URL.createObjectURL(file);
                video.controls = true;
                video.muted = true;
                video.onload = () => URL.revokeObjectURL(video.src);
                preview.innerHTML = '';
                preview.appendChild(video);
            }
        }

        async function startAudioRecording() {
            try {
                audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioRecorder = new MediaRecorder(audioStream);
                const audioChunks = [];

                audioRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                audioRecorder.onstop = () => {
                    currentAudioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(currentAudioBlob);
                    const preview = document.getElementById('audioPreview');
                    const audio = document.createElement('audio');
                    audio.src = audioUrl;
                    audio.controls = true;
                    preview.innerHTML = '';
                    preview.appendChild(audio);
                    
                    document.getElementById('audioControls').style.display = 'none';
                    document.getElementById('recordAudioBtn').style.display = 'inline-block';
                };

                audioRecorder.start();
                document.getElementById('audioControls').style.display = 'block';
                document.getElementById('recordAudioBtn').style.display = 'none';
            } catch (error) {
                console.error('Error starting audio recording:', error);
                alert('Could not start audio recording. Please check your microphone permissions.');
            }
        }

        function stopAudioRecording() {
            if (audioRecorder && audioRecorder.state === 'recording') {
                audioRecorder.stop();
                if (audioStream) {
                    audioStream.getTracks().forEach(track => track.stop());
                }
            }
        }

        async function sendMultimodalMessage() {
            const textInput = document.getElementById('multimodalTextInput');
            const voiceSelect = document.getElementById('voiceSelect');
            const returnAudio = document.getElementById('returnAudio');
            const sendBtn = document.getElementById('sendMultimodalBtn');

            const message = textInput.value.trim();
            const speaker = voiceSelect.value;
            const includeAudio = returnAudio.checked;

            // Check if we have any input
            if (!message && !currentImageFile && !currentVideoFile && !currentAudioBlob) {
                alert('Please provide some input (text, image, video, or audio)');
                return;
            }

            sendBtn.disabled = true;
            sendBtn.textContent = 'Sending...';

            try {
                // Prepare the request data
                const requestData = {
                    message: message || null,
                    session_id: sessionId,
                    return_audio: includeAudio,
                    speaker: speaker,
                    conversation_history: []
                };

                // Convert files to base64
                if (currentImageFile) {
                    requestData.image_base64 = await fileToBase64(currentImageFile);
                }

                if (currentVideoFile) {
                    requestData.video_base64 = await fileToBase64(currentVideoFile);
                }

                if (currentAudioBlob) {
                    requestData.audio_base64 = await blobToBase64(currentAudioBlob);
                }

                // Add user message to chat
                let displayMessage = message;
                if (currentImageFile) displayMessage += ' [Image attached]';
                if (currentVideoFile) displayMessage += ' [Video attached]';
                if (currentAudioBlob) displayMessage += ' [Audio attached]';
                
                if (displayMessage.trim()) {
                    addMessage(displayMessage, 'user');
                }

                // Add thinking indicator
                const thinkingIndicator = addThinkingIndicator();

                // Send request
                const response = await fetch(`${SERVER_URL}/api/multimodal-chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                // Remove thinking indicator
                removeThinkingIndicator();

                if (data.success) {
                    // Add AI response
                    addMessage(data.text_response, 'assistant', 'multimodal');
                    
                    // Play audio response if available
                    if (data.has_audio && data.audio_response) {
                        playAudioResponse(data.audio_response);
                    }
                    
                    // Clear inputs and close panel
                    clearMultimodalInputs();
                    closeMultimodalPanel();
                } else {
                    addMessage('Sorry, I encountered an error processing your multimodal request: ' + (data.error || 'Unknown error'), 'assistant');
                }

            } catch (error) {
                console.error('Error sending multimodal message:', error);
                removeThinkingIndicator();
                addMessage('Sorry, I encountered an error sending your multimodal message.', 'assistant');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send';
            }
        }

        // Utility functions
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        function playAudioResponse(audioBase64) {
            try {
                const audioData = `data:audio/wav;base64,${audioBase64}`;
                const audio = new Audio(audioData);
                audio.play().catch(e => console.error('Error playing audio:', e));
            } catch (error) {
                console.error('Error creating audio:', error);
            }
        }
    </script>

    <!-- Location Insights Modal -->
    <div id="insightsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üèôÔ∏è AI Location Insights</h2>
                <span class="close" onclick="closeLocationInsightsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>Get comprehensive AI-powered insights about Canadian locations including property types, prices, schools, lifestyle, and more!</p>
                <div class="location-input-container">
                    <input 
                        type="text" 
                        id="locationInput" 
                        placeholder="Enter location (e.g., Toronto, Mississauga, Vancouver...)"
                        class="location-input"
                    >
                    <button id="getInsightsBtn" class="get-insights-btn">Get Insights</button>
                </div>
                <div id="insightsResults" class="insights-results" style="display: none;"></div>
            </div>
        </div>
    </div>
</body>
</html>