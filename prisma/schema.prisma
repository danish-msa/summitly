generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                 String              @id @default(cuid())
  name               String?
  email              String              @unique
  emailVerified      DateTime?
  image              String?
  phone              String?
  password           String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  role               UserRole            @default(SUBSCRIBER)
  accounts           Account[]
  agentProfile       AgentProfile?
  favorites          Favorite[]
  pages              Page[]
  properties         Property[]
  propertyWatchlists PropertyWatchlist[]
  savedProperties    SavedProperty[]
  savedComparables   SavedComparable[]
  searches           SearchHistory[]
  sessions           Session[]
  tours              Tour[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Property {
  id           String         @id @default(cuid())
  mlsNumber    String         @unique
  title        String
  description  String?
  price        Float
  propertyType PropertyType
  status       PropertyStatus @default(ACTIVE)
  streetNumber String?
  streetName   String?
  city         String
  state        String
  zipCode      String?
  country      String         @default("US")
  bedrooms     Int
  bathrooms    Float
  squareFeet   Int?
  lotSize      Float?
  yearBuilt    Int?
  latitude     Float?
  longitude    Float?
  images       String[]       @default([])
  features     String[]       @default([])
  userId       String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  favorites    Favorite[]
  user         User           @relation(fields: [userId], references: [id])
  views        PropertyView[]
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
}

model SavedProperty {
  id        String   @id @default(cuid())
  userId    String
  mlsNumber String
  notes     String?
  tags      String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, mlsNumber])
  @@index([userId])
  @@index([mlsNumber])
}

model SavedComparable {
  id                  String   @id @default(cuid())
  userId              String
  basePropertyMlsNumber String  // The property page the user is on
  mlsNumber           String   // The comparable property being saved
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, basePropertyMlsNumber, mlsNumber])
  @@index([userId])
  @@index([basePropertyMlsNumber])
  @@index([mlsNumber])
  @@index([userId, basePropertyMlsNumber])
}

model PropertyView {
  id         String   @id @default(cuid())
  propertyId String
  userId     String?
  ipAddress  String?
  userAgent  String?
  viewedAt   DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model SearchHistory {
  id           String        @id @default(cuid())
  userId       String
  query        String?
  location     String?
  minPrice     Float?
  maxPrice     Float?
  bedrooms     Int?
  bathrooms    Int?
  propertyType PropertyType?
  searchedAt   DateTime      @default(now())
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AgentProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  bio         String?
  phone       String?
  license     String?
  specialties String[] @default([])
  languages   String[] @default([])
  rating      Float    @default(0)
  reviewCount Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Contact {
  id         String        @id @default(cuid())
  name       String
  email      String
  phone      String?
  message    String
  propertyId String?
  type       ContactType   @default(GENERAL)
  status     ContactStatus @default(PENDING)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
}

model PropertyWatchlist {
  id              String   @id @default(cuid())
  userId          String
  mlsNumber       String?
  cityName        String?
  neighborhood    String?
  propertyType    String?
  watchProperty   Boolean  @default(false)
  newProperties   Boolean  @default(false)
  soldListings    Boolean  @default(false)
  expiredListings Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([mlsNumber])
  @@index([cityName, neighborhood])
}

model Tour {
  id            String     @id @default(cuid())
  userId        String
  mlsNumber     String
  tourType      TourType   @default(IN_PERSON)
  scheduledDate DateTime
  name          String
  phone         String
  email         String
  preApproval   Boolean    @default(false)
  status        TourStatus @default(PENDING)
  notes         String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([mlsNumber])
  @@index([scheduledDate])
}

model DevelopmentTeam {
  id          String        @id(map: "Developer_pkey") @default(cuid())
  name        String
  type        DeveloperType
  description String?
  website     String?
  image       String?
  email       String?
  phone       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([type])
  @@index([name])
}

model PreConstructionProject {
  id                      String                @id @default(cuid())
  mlsNumber               String                @unique
  projectName             String
  developer               String?
  startingPrice           Float?
  status                  String?
  streetNumber            String?
  streetName              String?
  city                    String?
  state                   String?
  zip                     String?
  country                 String?               @default("Canada")
  neighborhood            String?
  majorIntersection       String?
  latitude                Float?
  longitude               Float?
  propertyType            String?
  bedroomRange            String?
  bathroomRange           String?
  sqftRange               String?
  totalUnits              Int?
  availableUnits          Int?
  storeys                 Int?
  completionProgress      Int?
  images                  String[]              @default([])
  features                String[]              @default([])
  amenities               String[]              @default([])
  depositStructure        String?
  description             String?
  metaTitle               String?
  metaDescription         String?
  keywords                String[]              @default([])
  developerInfo           String?
  architectInfo           String?
  builderInfo             String?
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  documents               String?
  interiorDesignerInfo    String?
  landscapeArchitectInfo  String?
  marketingInfo           String?
  endingPrice             Float?
  subPropertyType         String?
  promotions              String?
  videos                  String[]              @default([])
  avgPricePerSqft         Float?
  parkingPrice            Float?
  parkingPriceDetail      String?
  lockerPrice             Float?
  lockerPriceDetail       String?
  assignmentFee           Float?
  developmentLevies       String?
  developmentCharges      Float?
  height                  String?
  maintenanceFeesPerSqft  Float?
  maintenanceFeesDetail   String?
  floorPremiums           String?
  salesMarketingCompany   String?
  hasDen                  Boolean               @default(false)
  hasStudio               Boolean               @default(false)
  hasLoft                 Boolean               @default(false)
  hasWorkLiveLoft         Boolean               @default(false)
  developmentTeamOverview String?
  suites                  Int?
  ownershipType           String?
  garage                  String?
  basement                String?
  occupancyDate           String?
  isPublished             Boolean               @default(false)
  featured                Boolean               @default(false)
  createdBy               String?
  units                   PreConstructionUnit[]

  @@index([city])
  @@index([status])
  @@index([propertyType])
  @@index([isPublished])
  @@index([featured])
  @@index([createdBy])
}

model PreConstructionUnit {
  id             String                 @id @default(cuid())
  projectId      String
  unitName       String
  beds           Int
  baths          Int
  sqft           Int
  price          Float
  maintenanceFee Float?
  status         String
  description    String?
  features       String[]               @default([])
  amenities      String[]               @default([])
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  images         String[]               @default([])
  studio         Boolean                @default(false)
  project        PreConstructionProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([status])
}

model PropertyRating {
  id           String   @id @default(cuid())
  propertyId   String
  propertyType String
  userId       String?
  sessionId    String?
  rating       Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([propertyId])
  @@index([propertyType])
  @@index([userId])
  @@index([propertyId, propertyType])
  @@index([propertyId, rating])
  @@index([propertyId, sessionId])
}

model PreConstructionPageContent {
  id              String                       @id @default(cuid())
  pageType        String
  pageValue       String
  title           String?
  description     String?
  heroImage       String?
  metaTitle       String?
  metaDescription String?
  customContent   String?
  isPublished     Boolean                      @default(false)
  createdAt       DateTime                     @default(now())
  updatedAt       DateTime                     @updatedAt
  faqs            String?
  locationType    String?
  parentId        String?
  parent          PreConstructionPageContent?  @relation("LocationHierarchy", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  children        PreConstructionPageContent[] @relation("LocationHierarchy")

  @@unique([pageType, pageValue])
  @@index([pageType])
  @@index([pageValue])
  @@index([isPublished])
  @@index([locationType])
  @@index([parentId])
}

model Page {
  id         String        @id @default(cuid())
  title      String
  slug       String        @unique
  content    String?
  excerpt    String?
  status     PageStatus    @default(DRAFT)
  parentId   String?
  categoryId String?
  createdBy  String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  category   PageCategory? @relation(fields: [categoryId], references: [id])
  creator    User          @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  parent     Page?         @relation("PageHierarchy", fields: [parentId], references: [id])
  children   Page[]        @relation("PageHierarchy")

  @@index([slug])
  @@index([status])
  @@index([parentId])
  @@index([categoryId])
  @@index([createdBy])
}

model PageCategory {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  pages       Page[]

  @@index([slug])
}

model MarketTrends {
  id                       String   @id @default(cuid())
  locationType             String
  locationName             String
  parentCity               String?
  parentArea               String?
  parentNeighbourhood      String?
  month                    String
  priceOverview            Json?
  averageSoldPrice         Json?
  salesVolumeByType        Json?
  priceByBedrooms          Json?
  inventoryOverview        Json?
  newClosedAvailable       Json?
  daysOnMarket             Json?
  lastFetchedAt            DateTime @default(now())
  createdAt                DateTime @default(now())
  updatedAt                DateTime @default(now()) @updatedAt
  averageSoldPriceByType   Json?
  years                    Int      @default(2)
  medianListingVsSoldPrice Json?

  @@unique([locationType, locationName, month, years])
  @@unique([locationType, locationName, month])
  @@index([locationType])
  @@index([locationName])
  @@index([locationType, locationName])
  @@index([month])
  @@index([years])
  @@index([locationType, locationName, month, years])
  @@index([parentCity])
  @@index([parentArea])
  @@index([lastFetchedAt])
  @@index([locationType, locationName, month])
  @@index([priceOverview], type: Gin)
}

model MarketRankings {
  id              String   @id @default(cuid())
  month           String   @unique
  rankings        Json
  rankingOverview Json
  lastFetchedAt   DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt

  @@index([month])
  @@index([lastFetchedAt])
}

model CityBreakdown {
  id            String   @id @default(cuid())
  month         String   @unique
  breakdownData Json
  lastFetchedAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt

  @@index([month])
  @@index([lastFetchedAt])
}

model PropertyTypeBreakdown {
  id            String   @id @default(cuid())
  month         String   @unique
  breakdownData Json
  lastFetchedAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt

  @@index([month])
  @@index([lastFetchedAt])
}

model table_name {
  id          BigInt   @id @default(autoincrement())
  inserted_at DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  updated_at  DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  data        Json?
  name        String?
}

enum UserRole {
  SUBSCRIBER
  ADMIN
  SUPER_ADMIN
}

enum PageStatus {
  DRAFT
  PUBLISHED
}

enum PropertyType {
  HOUSE
  APARTMENT
  CONDO
  TOWNHOUSE
  VILLA
  OFFICE
  COMMERCIAL
  LAND
  OTHER
}

enum PropertyStatus {
  ACTIVE
  PENDING
  SOLD
  RENTED
  INACTIVE
}

enum ContactType {
  GENERAL
  PROPERTY_INQUIRY
  AGENT_REQUEST
  SUPPORT
}

enum ContactStatus {
  PENDING
  CONTACTED
  RESOLVED
  CLOSED
}

enum TourType {
  IN_PERSON
  VIDEO_CHAT
}

enum TourStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum DeveloperType {
  DEVELOPER
  ARCHITECT
  INTERIOR_DESIGNER
  BUILDER
  LANDSCAPE_ARCHITECT
  MARKETING
}
